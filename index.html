<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>HANZZ TKA TRYOUT - LOGIN</title>
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        body {
            background: linear-gradient(145deg, #f0f4f8, #e6ecf4);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            width: 100%;
            margin: 0 auto;
        }
        /* LOGIN PAGE */
        .login-container {
            background: white;
            border-radius: 40px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            padding: 50px 40px;
            text-align: center;
            max-width: 500px;
            margin: 0 auto;
        }
        .login-container h1 {
            font-size: 2.8rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 10px;
        }
        .login-container h1 span {
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .login-container .sub {
            color: #64748b;
            font-size: 1.2rem;
            margin-bottom: 30px;
        }
        .token-box {
            background: #f1f5f9;
            border-radius: 30px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px dashed #94a3b8;
        }
        .token-label {
            font-size: 1.2rem;
            color: #475569;
            margin-bottom: 10px;
        }
        .token-value {
            font-family: monospace;
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: 8px;
            color: #2563eb;
            background: white;
            padding: 15px 20px;
            border-radius: 60px;
            border: 2px solid #cbd5e1;
            display: inline-block;
        }
        .input-group {
            text-align: left;
            margin-bottom: 25px;
        }
        .input-group label {
            display: block;
            font-weight: 600;
            color: #334155;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        .input-group input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #cbd5e1;
            border-radius: 60px;
            font-size: 1.2rem;
            outline: none;
            transition: 0.15s;
        }
        .input-group input:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37,99,235,0.2);
        }
        .btn-login {
            background: #2563eb;
            color: white;
            font-size: 1.8rem;
            font-weight: 600;
            padding: 16px 30px;
            border: none;
            border-radius: 70px;
            width: 100%;
            cursor: pointer;
            box-shadow: 0 8px 0 #1e40af;
            transition: 0.1s;
            margin-top: 15px;
        }
        .btn-login:active {
            transform: translateY(5px);
            box-shadow: 0 3px 0 #1e40af;
        }
        .error-message {
            color: #ef4444;
            font-size: 1rem;
            margin-top: 15px;
            min-height: 20px;
        }
        /* HOME PAGE (setelah login) */
        .home-container {
            background: white;
            border-radius: 32px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            padding: 50px 40px;
            text-align: center;
            display: none;
        }
        .home-container h1 {
            font-size: 3.2rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 15px;
        }
        .home-container h1 span {
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .home-container .sub {
            color: #64748b;
            font-size: 1.3rem;
            margin-bottom: 30px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 25px;
        }
        .card-grid {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .home-card {
            background: #f8fafc;
            width: 280px;
            padding: 40px 25px;
            border-radius: 28px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.02);
            cursor: pointer;
            transition: all 0.25s;
            border: 2px solid transparent;
        }
        .home-card:hover {
            border-color: #2563eb;
            transform: translateY(-6px);
            box-shadow: 0 15px 30px rgba(37,99,235,0.1);
        }
        .home-card i {
            font-size: 4rem;
            color: #2563eb;
            margin-bottom: 20px;
        }
        .home-card h2 {
            font-size: 2.2rem;
            font-weight: 600;
            color: #0f172a;
        }
        .home-card p {
            color: #475569;
            font-size: 1.1rem;
            margin-top: 12px;
        }
        /* MODAL SIAP */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: 0.2s;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-card {
            background: white;
            max-width: 450px;
            width: 90%;
            border-radius: 40px;
            padding: 40px 30px;
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }
        .modal-card i {
            font-size: 4rem;
            color: #2563eb;
            margin-bottom: 20px;
        }
        .modal-card h3 {
            font-size: 2rem;
            font-weight: 600;
            color: #0f172a;
            margin-bottom: 15px;
        }
        .modal-card p {
            font-size: 1.2rem;
            color: #475569;
            margin-bottom: 30px;
        }
        .modal-btn {
            background: #10b981;
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            padding: 16px 30px;
            border: none;
            border-radius: 60px;
            cursor: pointer;
            box-shadow: 0 6px 0 #059669;
            transition: 0.1s;
            width: 100%;
        }
        .modal-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #059669;
        }
        /* MODAL SELESAI */
        #modalSelesai .modal-card i {
            color: #f59e0b;
        }
        #modalSelesai .modal-btn {
            background: #f59e0b;
            box-shadow: 0 6px 0 #d97706;
        }
        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .modal-actions .modal-btn {
            width: auto;
            padding: 14px 30px;
            font-size: 1.3rem;
        }
        .modal-actions .modal-btn.secondary {
            background: #94a3b8;
            box-shadow: 0 6px 0 #64748b;
        }
        /* SOAL PAGE */
        .soal-page {
            display: none;
        }
        .header-card {
            background: white;
            border-radius: 24px;
            padding: 22px 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 10px solid #2563eb;
            flex-wrap: wrap;
            gap: 15px;
        }
        .header-card h2 {
            font-size: 2rem;
            font-weight: 600;
            color: #0f172a;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .header-card h2 i {
            color: #2563eb;
            font-size: 2.2rem;
        }
        .user-info {
            background: #f1f5f9;
            padding: 10px 25px;
            border-radius: 50px;
            font-size: 1.2rem;
            color: #1e293b;
            border: 2px solid #cbd5e1;
        }
        .timer {
            background: #f1f5f9;
            padding: 12px 28px;
            border-radius: 50px;
            font-size: 1.6rem;
            font-weight: 700;
            color: #0f172a;
            border: 2px solid #cbd5e1;
            letter-spacing: 1px;
        }
        .soal-wrapper {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }
        .soal-card {
            background: white;
            border-radius: 24px;
            padding: 28px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.03);
            border: 1px solid #e9eef3;
        }
        .soal-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .soal-nomor {
            background: #2563eb;
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.3rem;
            box-shadow: 0 6px 12px rgba(37,99,235,0.25);
        }
        .soal-tipe {
            background: #dbeafe;
            color: #1e40af;
            padding: 6px 20px;
            border-radius: 40px;
            font-size: 1rem;
            font-weight: 600;
        }
        .soal-gambar {
            margin: 15px 0 20px;
            background: #f8fafc;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            border: 2px dashed #cbd5e1;
            color: #334155;
            font-size: 1.1rem;
        }
        .soal-gambar i {
            font-size: 3.5rem;
            color: #2563eb;
            margin-bottom: 10px;
        }
        .soal-teks {
            font-size: 1.15rem;
            line-height: 1.7;
            color: #1e293b;
            margin: 15px 0 25px;
            white-space: pre-line;
            background: #f8fafc;
            padding: 20px;
            border-radius: 18px;
            border-left: 6px solid #2563eb;
        }
        .opsi {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .opsi-item {
            display: flex;
            align-items: center;
            gap: 18px;
            background: #f9fafc;
            border: 2px solid #e2e8f0;
            border-radius: 50px;
            padding: 14px 22px;
            cursor: pointer;
            transition: 0.15s;
            font-size: 1.05rem;
        }
        .opsi-item:hover {
            background: #eff6ff;
            border-color: #2563eb;
        }
        .opsi-item input {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: #2563eb;
        }
        .opsi-item label {
            flex: 1;
            font-size: 1.05rem;
            cursor: pointer;
            color: #1e293b;
            font-weight: 500;
        }
        .btn-submit {
            background: #10b981;
            color: white;
            font-size: 1.8rem;
            font-weight: 600;
            padding: 18px 35px;
            border: none;
            border-radius: 70px;
            width: 100%;
            max-width: 400px;
            margin: 35px auto 0;
            display: block;
            cursor: pointer;
            box-shadow: 0 8px 0 #059669;
            transition: 0.1s;
        }
        .btn-submit:active {
            transform: translateY(5px);
            box-shadow: 0 3px 0 #059669;
        }
        /* Hasil panel */
        .hasil-panel {
            background: white;
            border-radius: 32px;
            padding: 35px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            margin-top: 30px;
        }
        .nilai-box {
            background: #f1f5f9;
            padding: 20px 35px;
            border-radius: 70px;
            font-size: 2rem;
            font-weight: 700;
            display: inline-block;
            color: #0f172a;
            border: 2px solid #cbd5e1;
        }
        .key-area {
            background: #f1f5f9;
            border-radius: 35px;
            padding: 30px;
            margin: 25px 0;
            border: 2px dashed #94a3b8;
        }
        .key-string {
            font-family: monospace;
            font-size: 2.2rem;
            background: white;
            padding: 12px 30px;
            border-radius: 60px;
            display: inline-block;
            letter-spacing: 4px;
            border: 2px solid #94a3b8;
            color: #0f172a;
            margin: 10px 0;
            word-break: break-all;
        }
        .exit-form {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            background: #f1f5f9;
            padding: 25px;
            border-radius: 60px;
        }
        .exit-form input {
            flex: 2;
            min-width: 250px;
            background: white;
            border: 2px solid #cbd5e1;
            padding: 16px 25px;
            border-radius: 60px;
            font-size: 1.3rem;
            color: #0f172a;
            text-align: center;
            font-family: monospace;
            outline: none;
        }
        .exit-form button {
            flex: 1;
            background: #ef4444;
            border: none;
            padding: 16px 25px;
            border-radius: 60px;
            font-weight: 600;
            font-size: 1.4rem;
            color: white;
            cursor: pointer;
            box-shadow: 0 6px 0 #b91c1c;
            border: 1px solid #fecaca;
        }
        .exit-form button:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #b91c1c;
        }
        .peringatan {
            color: #475569;
            font-size: 1rem;
            margin-top: 20px;
            text-align: center;
        }
        footer {
            text-align: center;
            margin-top: 30px;
            color: #64748b;
            font-size: 1rem;
        }
        .soal-wrapper::-webkit-scrollbar {
            width: 8px;
        }
        .soal-wrapper::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        @media (max-width: 600px) {
            .login-container { padding: 30px 20px; }
            .token-value { font-size: 1.8rem; letter-spacing: 4px; }
            .home-container { padding: 30px 20px; }
            .home-container h1 { font-size: 2.5rem; }
            .header-card { flex-direction: column; align-items: flex-start; }
            .timer { align-self: flex-start; font-size: 1.4rem; padding: 10px 20px; }
        }
    </style>
</head>
<body>
<div class="container">
    <!-- HALAMAN LOGIN -->
    <div id="loginPage" class="login-container">
        <h1><span>HANZZ</span> TKA TRYOUT</h1>
        <div class="sub">Masukkan token dan nama untuk memulai</div>
        <div class="token-box">
            <div class="token-label">Token Akses</div>
            <div class="token-value" id="tokenDisplay">ABCD12</div>
        </div>
        <div class="input-group">
            <label>Masukkan Token</label>
            <input type="text" id="tokenInput" placeholder="Salin token di atas" autocomplete="off">
        </div>
        <div class="input-group">
            <label>Nama Lengkap</label>
            <input type="text" id="namaInput" placeholder="Masukkan nama Anda" autocomplete="off">
        </div>
        <button class="btn-login" id="btnLogin">MASUK</button>
        <div class="error-message" id="loginError"></div>
    </div>

    <!-- HALAMAN HOME (setelah login) -->
    <div id="homePage" class="home-container">
        <h1><span>HANZZ</span> TKA TRYOUT</h1>
        <div class="sub">Selamat datang, <span id="namaDisplay">User</span>! Pilih mata pelajaran untuk memulai ujian (durasi 90 menit)</div>
        <div class="card-grid">
            <div class="home-card" id="btnIndo">
                <i class="fas fa-book-open"></i>
                <h2>B.INDO</h2>
                <p>30 soal ‚Ä¢ PG, PGK, B/S</p>
            </div>
            <div class="home-card" id="btnMat">
                <i class="fas fa-calculator"></i>
                <h2>MATEMATIKA</h2>
                <p>30 soal ‚Ä¢ PG, PGK, B/S</p>
            </div>
        </div>
        <footer>¬© HANZZ SECURE ‚Ä¢ pilih mapel untuk memulai</footer>
    </div>

    <!-- MODAL KONFIRMASI SIAP UJIAN -->
    <div id="modalSiap" class="modal-overlay">
        <div class="modal-card">
            <i class="fas fa-praying-hands"></i>
            <h3>Apakah Anda Siap?</h3>
            <p>Berdoa terlebih dahulu sebelum memulai ujian. Setelah tombol ditekan, browser akan terkunci dan masuk mode fullscreen. Jawaban akan direset jika Anda keluar paksa.</p>
            <button class="modal-btn" id="btnMulaiUjian">üîí Mulai & Kunci Browser</button>
        </div>
    </div>

    <!-- MODAL KONFIRMASI SELESAI TRYOUT -->
    <div id="modalSelesai" class="modal-overlay">
        <div class="modal-card">
            <i class="fas fa-question-circle"></i>
            <h3>Yakin ingin menyelesaikan?</h3>
            <p>Pastikan semua jawaban sudah final. Anda tidak dapat mengubahnya setelah ini.</p>
            <div class="modal-actions">
                <button class="modal-btn secondary" id="batalSelesai">Batal</button>
                <button class="modal-btn" id="konfirmasiSelesai">Ya, Selesai</button>
            </div>
        </div>
    </div>

    <!-- HALAMAN SOAL B.INDONESIA -->
    <div id="indoPage" class="soal-page">
        <div class="header-card">
            <h2><i class="fas fa-book-open"></i> Bahasa Indonesia</h2>
            <div class="user-info" id="indoUser">User</div>
            <div class="timer" id="indoTimer">01:30:00</div>
        </div>
        <div class="soal-wrapper" id="indoSoalContainer"></div>
        <button class="btn-submit" id="submitIndo">Selesai & Lihat Hasil</button>
        <div id="indoHasil" class="hasil-panel" style="display: none;"></div>
    </div>

    <!-- HALAMAN SOAL MATEMATIKA -->
    <div id="matPage" class="soal-page">
        <div class="header-card">
            <h2><i class="fas fa-calculator"></i> Matematika</h2>
            <div class="user-info" id="matUser">User</div>
            <div class="timer" id="matTimer">01:30:00</div>
        </div>
        <div class="soal-wrapper" id="matSoalContainer"></div>
        <button class="btn-submit" id="submitMat">Selesai & Lihat Hasil</button>
        <div id="matHasil" class="hasil-panel" style="display: none;"></div>
    </div>
</div>

<script>
(function() {
    // ====================  DATA SOAL (sama seperti sebelumnya) ====================
    const soalIndo = [];
    const soalMat = [];

    function getGambarIndo(seed) {
        const icons = [
            '<i class="fas fa-book-open" style="font-size:3rem; color:#2563eb;"></i><br>Ilustrasi buku teks',
            '<i class="fas fa-feather" style="font-size:3rem; color:#2563eb;"></i><br>Ilustrasi menulis',
            '<i class="fas fa-scroll" style="font-size:3rem; color:#2563eb;"></i><br>Naskah kuno',
            '<i class="fas fa-newspaper" style="font-size:3rem; color:#2563eb;"></i><br>Artikel koran',
            '<i class="fas fa-pen-fancy" style="font-size:3rem; color:#2563eb;"></i><br>Puisi',
            '<i class="fas fa-microphone-alt" style="font-size:3rem; color:#2563eb;"></i><br>Pidato'
        ];
        return icons[seed % icons.length];
    }
    function getGambarMat(seed) {
        const icons = [
            '<i class="fas fa-calculator" style="font-size:3rem; color:#2563eb;"></i><br>Kalkulator',
            '<i class="fas fa-chart-bar" style="font-size:3rem; color:#2563eb;"></i><br>Diagram batang',
            '<i class="fas fa-chart-pie" style="font-size:3rem; color:#2563eb;"></i><br>Diagram lingkaran',
            '<i class="fas fa-shapes" style="font-size:3rem; color:#2563eb;"></i><br>Bangun datar',
            '<i class="fas fa-cube" style="font-size:3rem; color:#2563eb;"></i><br>Bangun ruang',
            '<i class="fas fa-ruler-combined" style="font-size:3rem; color:#2563eb;"></i><br>Penggaris'
        ];
        return icons[seed % icons.length];
    }

    // 30 soal Bahasa Indonesia
    for (let i = 0; i < 30; i++) {
        let tipe = (i % 3 === 0) ? 'pg' : (i % 3 === 1) ? 'pgk' : 'bs';
        let teks, opsi, kunci, gambar;
        if (tipe === 'pg') {
            if (i < 10) {
                teks = `Bacalah paragraf berikut dengan saksama!\n\n"Pendidikan karakter merupakan fondasi utama dalam membentuk generasi muda yang berakhlak mulia. Melalui pendidikan karakter, nilai-nilai seperti kejujuran, kedisiplinan, dan tanggung jawab dapat ditanamkan sejak dini. Hal ini sejalan dengan tujuan pendidikan nasional yang tidak hanya mencerdaskan kehidupan bangsa, tetapi juga membentuk watak dan peradaban yang bermartabat."\n\nIde pokok paragraf tersebut adalah...`;
                opsi = [
                    { teks: 'Fondasi pendidikan karakter', nilai: 'A' },
                    { teks: 'Tujuan pendidikan nasional', nilai: 'B' },
                    { teks: 'Nilai-nilai kejujuran', nilai: 'C' },
                    { teks: 'Pembentukan watak bangsa', nilai: 'D' }
                ];
                kunci = 'A';
                gambar = getGambarIndo(i);
            } else if (i < 20) {
                teks = `Cermati kutipan cerpen berikut!\n\n"Matahari mulai condong ke barat ketika aku tiba di stasiun tua itu. Aroma kopi bercampur asap rokok menyambutku. Di sudut ruang tunggu, seorang kakek duduk termenung memandangi rel yang mulai berkarat. Mungkin ia sedang mengenang masa mudanya, pikirku."\n\nLatar suasana dalam kutipan tersebut adalah...`;
                opsi = [
                    { teks: 'Gembira dan riang', nilai: 'A' },
                    { teks: 'Sunyi dan sendu', nilai: 'B' },
                    { teks: 'Ramai dan meriah', nilai: 'C' },
                    { teks: 'Mencekam', nilai: 'D' }
                ];
                kunci = 'B';
                gambar = '<i class="fas fa-train" style="font-size:3rem; color:#2563eb;"></i><br>Suasana stasiun tua';
            } else {
                teks = `Bacalah puisi berikut!\n\n"Hujan di bulan Juni\nTak ada yang lebih tabah\nDari hujan di bulan Juni\nDirahasiakannya rintik rindunya"\n\nMajas yang digunakan dalam puisi tersebut adalah...`;
                opsi = [
                    { teks: 'Personifikasi', nilai: 'A' },
                    { teks: 'Metafora', nilai: 'B' },
                    { teks: 'Hiperbola', nilai: 'C' },
                    { teks: 'Litotes', nilai: 'D' }
                ];
                kunci = 'A';
                gambar = '<i class="fas fa-cloud-rain" style="font-size:3rem; color:#2563eb;"></i><br>Hujan';
            }
        } else if (tipe === 'pgk') {
            teks = `Perhatikan teks prosedur berikut!\n\n"Cara membuat telur dadar: 1. Kocok telur bersama garam dan merica. 2. Panaskan minyak di wajan. 3. Goreng telur hingga matang. 4. Angkat dan sajikan."\n\nManakah pernyataan yang benar tentang teks tersebut? (pilih semua yang sesuai)`;
            opsi = [
                { teks: 'Menggunakan kalimat imperatif', nilai: 'A' },
                { teks: 'Terdapat kata kerja material', nilai: 'B' },
                { teks: 'Langkah-langkah disusun secara acak', nilai: 'C' },
                { teks: 'Menggunakan konjungsi temporal', nilai: 'D' }
            ];
            kunci = ['A', 'B', 'D'];
            gambar = '<i class="fas fa-utensils" style="font-size:3rem; color:#2563eb;"></i><br>Memasak';
        } else {
            teks = `Pernyataan: "Teks eksposisi bertujuan untuk meyakinkan pembaca tentang suatu hal." Menurut pendapatmu, pernyataan tersebut...`;
            opsi = [
                { teks: 'Benar', nilai: true },
                { teks: 'Salah', nilai: false }
            ];
            kunci = true;
            gambar = '<i class="fas fa-check-circle" style="font-size:3rem; color:#2563eb;"></i><br>Eksposisi';
        }
        soalIndo.push({ tipe, teks, opsi, kunci, gambar });
    }

    // 30 soal Matematika
    for (let i = 0; i < 30; i++) {
        let tipe = (i % 3 === 0) ? 'pg' : (i % 3 === 1) ? 'pgk' : 'bs';
        let teks, opsi, kunci, gambar;
        if (tipe === 'pg') {
            if (i < 10) {
                teks = `Perhatikan gambar bangun berikut! (Ilustrasi persegi panjang)\n\nSebuah persegi panjang memiliki panjang (2x + 3) cm dan lebar (x - 1) cm. Jika kelilingnya 44 cm, maka nilai x adalah...`;
                opsi = [
                    { teks: '5', nilai: 'A' },
                    { teks: '6', nilai: 'B' },
                    { teks: '7', nilai: 'C' },
                    { teks: '8', nilai: 'D' }
                ];
                kunci = 'C';
                gambar = '<i class="fas fa-square" style="font-size:3rem; color:#2563eb;"></i><br>Persegi panjang';
            } else if (i < 20) {
                teks = `Diagram lingkaran berikut menunjukkan data kegemaran siswa: 40% suka olahraga, 25% suka musik, 20% suka membaca, dan sisanya suka melukis. Jika jumlah siswa 200 orang, berapa banyak siswa yang suka melukis?`;
                opsi = [
                    { teks: '20 orang', nilai: 'A' },
                    { teks: '25 orang', nilai: 'B' },
                    { teks: '30 orang', nilai: 'C' },
                    { teks: '40 orang', nilai: 'D' }
                ];
                kunci = 'C';
                gambar = '<i class="fas fa-chart-pie" style="font-size:3rem; color:#2563eb;"></i><br>Diagram lingkaran';
            } else {
                teks = `Sebuah tangga sepanjang 5 meter disandarkan pada dinding. Jika jarak ujung bawah tangga ke dinding 3 meter, maka tinggi dinding yang dicapai tangga adalah...`;
                opsi = [
                    { teks: '4 m', nilai: 'A' },
                    { teks: '5 m', nilai: 'B' },
                    { teks: '6 m', nilai: 'C' },
                    { teks: '7 m', nilai: 'D' }
                ];
                kunci = 'A';
                gambar = '<i class="fas fa-ladder" style="font-size:3rem; color:#2563eb;"></i><br>Tangga';
            }
        } else if (tipe === 'pgk') {
            teks = `Sifat-sifat yang dimiliki oleh belah ketupat adalah... (pilih semua yang benar)`;
            opsi = [
                { teks: 'Keempat sisi sama panjang', nilai: 'A' },
                { teks: 'Sudut yang berhadapan sama besar', nilai: 'B' },
                { teks: 'Diagonal berpotongan tegak lurus', nilai: 'C' },
                { teks: 'Memiliki simetri lipat tak terhingga', nilai: 'D' }
            ];
            kunci = ['A', 'B', 'C'];
            gambar = '<i class="fas fa-diamond" style="font-size:3rem; color:#2563eb;"></i><br>Belah ketupat';
        } else {
            teks = `"Rumus volume kerucut adalah V = 1/3 √ó œÄ √ó r¬≤ √ó t." Pernyataan tersebut...`;
            opsi = [
                { teks: 'Benar', nilai: true },
                { teks: 'Salah', nilai: false }
            ];
            kunci = true;
            gambar = '<i class="fas fa-cone" style="font-size:3rem; color:#2563eb;"></i><br>Kerucut';
        }
        soalMat.push({ tipe, teks, opsi, kunci, gambar });
    }

    // ====================  LOGIN & TOKEN ====================
    const loginPage = document.getElementById('loginPage');
    const homePage = document.getElementById('homePage');
    const tokenDisplay = document.getElementById('tokenDisplay');
    const tokenInput = document.getElementById('tokenInput');
    const namaInput = document.getElementById('namaInput');
    const btnLogin = document.getElementById('btnLogin');
    const loginError = document.getElementById('loginError');
    const namaDisplay = document.getElementById('namaDisplay');
    const indoUser = document.getElementById('indoUser');
    const matUser = document.getElementById('matUser');

    // Generate token acak 6 karakter (huruf kapital + angka)
    function generateToken() {
        const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
        let token = '';
        for (let i = 0; i < 6; i++) {
            token += chars[Math.floor(Math.random() * chars.length)];
        }
        return token;
    }

    let currentToken = generateToken();
    tokenDisplay.textContent = currentToken;

    btnLogin.addEventListener('click', () => {
        const inputToken = tokenInput.value.trim().toUpperCase();
        const nama = namaInput.value.trim();

        if (inputToken === '') {
            loginError.textContent = 'Token harus diisi.';
            return;
        }
        if (nama === '') {
            loginError.textContent = 'Nama harus diisi.';
            return;
        }
        if (inputToken !== currentToken) {
            loginError.textContent = 'Token salah. Silakan coba lagi.';
            return;
        }

        // Login sukses
        loginError.textContent = '';
        // Simpan nama di localStorage agar bisa dipakai di halaman soal
        localStorage.setItem('userName', nama);
        namaDisplay.textContent = nama;
        indoUser.textContent = nama;
        matUser.textContent = nama;

        // Tampilkan home, sembunyikan login
        loginPage.style.display = 'none';
        homePage.style.display = 'block';
    });

    // ====================  STATE UJIAN ====================
    let isLocked = false;
    let currentMapel = null;
    let jawabanIndo = new Array(30).fill(null);
    let jawabanMat = new Array(30).fill(null);
    let currentExitKey = '';
    let selectedMapel = null;
    let pendingSubmitMapel = null;

    // Timer
    let timerInterval = null;
    let waktuTersisa = 90 * 60;
    const timerIndo = document.getElementById('indoTimer');
    const timerMat = document.getElementById('matTimer');

    // Elemen
    const modalSiap = document.getElementById('modalSiap');
    const modalSelesai = document.getElementById('modalSelesai');
    const btnMulaiUjian = document.getElementById('btnMulaiUjian');
    const btnBatalSelesai = document.getElementById('batalSelesai');
    const btnKonfirmasiSelesai = document.getElementById('konfirmasiSelesai');
    const indoPage = document.getElementById('indoPage');
    const matPage = document.getElementById('matPage');
    const btnIndo = document.getElementById('btnIndo');
    const btnMat = document.getElementById('btnMat');
    const submitIndo = document.getElementById('submitIndo');
    const submitMat = document.getElementById('submitMat');
    const indoSoalContainer = document.getElementById('indoSoalContainer');
    const matSoalContainer = document.getElementById('matSoalContainer');
    const indoHasilDiv = document.getElementById('indoHasil');
    const matHasilDiv = document.getElementById('matHasil');

    // ====================  CEK RESET JIKA SEBELUMNYA KELUAR PAKSA ====================
    if (sessionStorage.getItem('examActive')) {
        jawabanIndo.fill(null);
        jawabanMat.fill(null);
        sessionStorage.removeItem('examActive');
    }

    // ====================  FUNGSI PENGUNCIAN SUPER KETAT ====================
    function setLock(lock) {
        isLocked = lock;
        if (lock) {
            window.onbeforeunload = (e) => {
                e.preventDefault();
                e.returnValue = '‚ö†Ô∏è Ujian masih berlangsung! Anda harus menyelesaikan ujian dan menggunakan KEY untuk keluar.';
                return '‚ö†Ô∏è Ujian masih berlangsung! Anda harus menyelesaikan ujian dan menggunakan KEY untuk keluar.';
            };
            history.pushState(null, null, location.href);
            window.addEventListener('popstate', preventBack);
        } else {
            window.onbeforeunload = null;
            window.removeEventListener('popstate', preventBack);
        }
    }

    function preventBack(e) {
        if (isLocked) {
            history.pushState(null, null, location.href);
            alert('üö´ Tombol back diblokir selama ujian!');
        }
    }

    document.addEventListener('keydown', (e) => {
        if (!isLocked) return;
        const key = e.key;
        const ctrl = e.ctrlKey;
        const shift = e.shiftKey;
        const alt = e.altKey;
        const meta = e.metaKey;
        const blocked = [
            key === 'F12',
            ctrl && shift && (key === 'I' || key === 'J' || key === 'C'),
            ctrl && key === 'U',
            key === 'F5',
            ctrl && (key === 'r' || key === 'R'),
            ctrl && shift && (key === 'r' || key === 'R'),
            ctrl && (key === 'w' || key === 'W'),
            ctrl && (key === 'f4' || key === 'F4'),
            alt && (key === 'F4'),
            ctrl && (key === 't' || key === 'T' || key === 'n' || key === 'N'),
            ctrl && (key === 'p' || key === 'P'),
            ctrl && (key === 's' || key === 'S'),
            ctrl && (key === 'f' || key === 'F'),
            alt && (key === 'ArrowLeft' || key === 'ArrowRight'),
            key === 'PrintScreen',
            ctrl && shift && (key === 's' || key === 'S'),
        ];
        if (blocked.includes(true)) {
            e.preventDefault();
            e.stopPropagation();
            alert('üîí Akses ditolak! (Mode ujian terkunci)');
            return false;
        }
        if (ctrl || alt || meta) {
            e.preventDefault();
            alert('üîí Tombol kombinasi diblokir selama ujian.');
            return false;
        }
    });

    document.addEventListener('contextmenu', (e) => { if (isLocked) e.preventDefault(); });
    document.addEventListener('copy', (e) => { if (isLocked) e.preventDefault(); });
    document.addEventListener('cut', (e) => { if (isLocked) e.preventDefault(); });
    document.addEventListener('paste', (e) => { if (isLocked) e.preventDefault(); });
    document.addEventListener('dragstart', (e) => { if (isLocked) e.preventDefault(); });

    setInterval(() => {
        if (isLocked) {
            const widthThreshold = window.outerWidth - window.innerWidth > 200;
            const heightThreshold = window.outerHeight - window.innerHeight > 200;
            if (widthThreshold || heightThreshold) {
                alert('üîí DevTools terdeteksi! Ujian dihentikan.');
                document.body.innerHTML = '<h1 style="color:red;padding:50px;">Akses ditutup karena kecurangan.</h1>';
            }
        }
    }, 1000);

    document.addEventListener('visibilitychange', () => {
        if (isLocked && document.hidden) {
            alert('‚ö†Ô∏è Anda meninggalkan tab ujian!');
        }
    });

    // ====================  FUNGSI FULLSCREEN ====================
    function openFullscreen() {
        let elem = document.documentElement;
        if (elem.requestFullscreen) {
            elem.requestFullscreen();
        } else if (elem.webkitRequestFullscreen) {
            elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) {
            elem.msRequestFullscreen();
        }
    }

    function exitFullscreen() {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
    }

    // ====================  FUNGSI TIMER ====================
    function formatWaktu(detik) {
        let jam = Math.floor(detik / 3600);
        let menit = Math.floor((detik % 3600) / 60);
        let det = detik % 60;
        return `${jam.toString().padStart(2,'0')}:${menit.toString().padStart(2,'0')}:${det.toString().padStart(2,'0')}`;
    }

    function mulaiTimer(mapel) {
        if (timerInterval) clearInterval(timerInterval);
        waktuTersisa = 90 * 60;
        const timerElement = (mapel === 'indo') ? timerIndo : timerMat;
        timerElement.textContent = formatWaktu(waktuTersisa);

        timerInterval = setInterval(() => {
            if (waktuTersisa <= 0) {
                clearInterval(timerInterval);
                timerInterval = null;
                if (mapel === 'indo') {
                    if (submitIndo.style.display !== 'none') paksaSubmit('indo');
                } else {
                    if (submitMat.style.display !== 'none') paksaSubmit('mat');
                }
                return;
            }
            waktuTersisa--;
            timerElement.textContent = formatWaktu(waktuTersisa);
        }, 1000);
    }

    function hentikanTimer() {
        if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
        }
    }

    function paksaSubmit(mapel) {
        if (mapel === 'indo') {
            submitIndo.style.display = 'none';
            tampilkanHasil('indo', indoHasilDiv, soalIndo, jawabanIndo);
        } else {
            submitMat.style.display = 'none';
            tampilkanHasil('mat', matHasilDiv, soalMat, jawabanMat);
        }
    }

    // ====================  RENDER SOAL ====================
    function renderSoal(container, mapel, soalArray, jawabanArray) {
        let html = '';
        soalArray.forEach((soal, idx) => {
            const nomor = idx + 1;
            let tipeLabel = soal.tipe === 'pg' ? 'Pilihan Ganda' : (soal.tipe === 'pgk' ? 'Pilihan Ganda Kompleks' : 'Benar/Salah');
            html += `<div class="soal-card" data-nomor="${idx}" data-tipe="${soal.tipe}">`;
            html += `<div class="soal-header">`;
            html += `<div class="soal-nomor">${nomor}</div>`;
            html += `<div class="soal-tipe">${tipeLabel}</div>`;
            html += `</div>`;
            if (soal.gambar) html += `<div class="soal-gambar">${soal.gambar}</div>`;
            html += `<div class="soal-teks">${soal.teks}</div>`;
            html += `<div class="opsi">`;

            soal.opsi.forEach((opt, optIdx) => {
                const inputType = (soal.tipe === 'pgk') ? 'checkbox' : 'radio';
                const name = `opt_${mapel}_${idx}`;
                let checked = false;
                if (jawabanArray[idx] !== null) {
                    if (soal.tipe === 'pgk') {
                        checked = jawabanArray[idx].includes(opt.nilai);
                    } else if (soal.tipe === 'pg') {
                        checked = (jawabanArray[idx] === opt.nilai);
                    } else { // bs
                        checked = (jawabanArray[idx] === opt.nilai);
                    }
                }
                html += `<div class="opsi-item">`;
                html += `<input type="${inputType}" name="${name}" value="${opt.nilai}" id="${name}_${optIdx}" data-nilai="${opt.nilai}" ${checked ? 'checked' : ''}>`;
                html += `<label for="${name}_${optIdx}">${opt.teks}</label>`;
                html += `</div>`;
            });
            html += `</div></div>`;
        });
        container.innerHTML = html;

        container.querySelectorAll('.soal-card').forEach((item) => {
            const nomor = parseInt(item.dataset.nomor);
            const tipe = item.dataset.tipe;
            const opsiDiv = item.querySelector('.opsi');
            opsiDiv.addEventListener('change', (e) => {
                if (tipe === 'pgk') {
                    const checkedValues = [];
                    opsiDiv.querySelectorAll('input[type=checkbox]:checked').forEach(cb => {
                        checkedValues.push(cb.value);
                    });
                    if (mapel === 'indo') jawabanIndo[nomor] = checkedValues;
                    else jawabanMat[nomor] = checkedValues;
                } else {
                    const selected = opsiDiv.querySelector('input[type=radio]:checked');
                    if (selected) {
                        const nilai = selected.value;
                        if (tipe === 'bs') {
                            if (mapel === 'indo') jawabanIndo[nomor] = (nilai === 'true');
                            else jawabanMat[nomor] = (nilai === 'true');
                        } else {
                            if (mapel === 'indo') jawabanIndo[nomor] = nilai;
                            else jawabanMat[nomor] = nilai;
                        }
                    }
                }
            });
        });
    }

    // Hitung skor
    function hitungSkor(soalArray, jawabanArray) {
        let benar = 0;
        for (let i = 0; i < soalArray.length; i++) {
            const soal = soalArray[i];
            const jawab = jawabanArray[i];
            if (jawab === null) continue;
            if (soal.tipe === 'pg') {
                if (jawab === soal.kunci) benar++;
            } else if (soal.tipe === 'pgk') {
                const kunciSet = new Set(soal.kunci);
                const jawabSet = new Set(jawab);
                let cocok = (kunciSet.size === jawabSet.size);
                if (cocok) {
                    for (let k of kunciSet) if (!jawabSet.has(k)) { cocok = false; break; }
                }
                if (cocok) benar++;
            } else { // bs
                if (jawab === soal.kunci) benar++;
            }
        }
        return benar;
    }

    // Tampilkan hasil dan key
    function tampilkanHasil(mapel, hasilDiv, soalArray, jawabanArray) {
        hentikanTimer();
        const skor = hitungSkor(soalArray, jawabanArray);
        const totalSoal = soalArray.length;
        const persen = (skor / totalSoal * 100).toFixed(2);
        const randomKey = 'HANZZ-' + Math.random().toString(36).substring(2,10).toUpperCase();
        currentExitKey = randomKey;

        sessionStorage.removeItem('examActive');

        let html = `
            <div class="nilai-box">Skor: ${skor}/${totalSoal} (${persen}%)</div>
            <div class="key-area">
                <div style="font-size:1.3rem;">üîë KELUAR KEY</div>
                <div class="key-string">${randomKey}</div>
                <button class="copyKeyBtn" style="background:#2563eb; color:white; border:none; padding:12px 30px; border-radius:40px; margin-top:10px; cursor:pointer; font-size:1.2rem;">üìã Salin Key</button>
            </div>
            <div class="exit-form">
                <input type="text" id="exitKeyInput" placeholder="masukkan key keluar">
                <button id="exitBtn">üö™ KELUAR UJIAN</button>
            </div>
            <div class="peringatan">‚ö†Ô∏è Key salah tidak bisa keluar</div>
        `;
        hasilDiv.innerHTML = html;
        hasilDiv.style.display = 'block';

        document.querySelectorAll(`#${mapel}Page .opsi input`).forEach(inp => inp.disabled = true);

        hasilDiv.querySelector('.copyKeyBtn').addEventListener('click', () => {
            navigator.clipboard.writeText(randomKey).then(() => alert('Key disalin!'));
        });

        const exitBtn = hasilDiv.querySelector('#exitBtn');
        const exitInput = hasilDiv.querySelector('#exitKeyInput');
        exitBtn.addEventListener('click', () => {
            if (exitInput.value.trim() === currentExitKey) {
                alert('‚úÖ Key benar. Kembali ke home.');
                exitFullscreen();
                setLock(false);
                currentMapel = null;
                jawabanIndo.fill(null);
                jawabanMat.fill(null);
                homePage.style.display = 'block';
                indoPage.style.display = 'none';
                matPage.style.display = 'none';
                indoHasilDiv.innerHTML = '';
                matHasilDiv.innerHTML = '';
                indoHasilDiv.style.display = 'none';
                matHasilDiv.style.display = 'none';
                submitIndo.style.display = 'block';
                submitMat.style.display = 'block';
                renderSoal(indoSoalContainer, 'indo', soalIndo, jawabanIndo);
                renderSoal(matSoalContainer, 'mat', soalMat, jawabanMat);
                timerIndo.textContent = '01:30:00';
                timerMat.textContent = '01:30:00';
            } else {
                alert('‚ùå Key salah!');
            }
        });
    }

    // ====================  EVENT HOME & MODAL ====================
    btnIndo.addEventListener('click', () => {
        selectedMapel = 'indo';
        modalSiap.classList.add('active');
    });

    btnMat.addEventListener('click', () => {
        selectedMapel = 'mat';
        modalSiap.classList.add('active');
    });

    btnMulaiUjian.addEventListener('click', () => {
        modalSiap.classList.remove('active');
        openFullscreen();

        homePage.style.display = 'none';
        if (selectedMapel === 'indo') {
            indoPage.style.display = 'block';
            matPage.style.display = 'none';
            currentMapel = 'indo';
            renderSoal(indoSoalContainer, 'indo', soalIndo, jawabanIndo);
            mulaiTimer('indo');
        } else {
            indoPage.style.display = 'none';
            matPage.style.display = 'block';
            currentMapel = 'mat';
            renderSoal(matSoalContainer, 'mat', soalMat, jawabanMat);
            mulaiTimer('mat');
        }

        sessionStorage.setItem('examActive', currentMapel);
        setLock(true);
    });

    // ====================  MODAL KONFIRMASI SELESAI ====================
    function showModalSelesai(mapel) {
        pendingSubmitMapel = mapel;
        modalSelesai.classList.add('active');
    }

    btnBatalSelesai.addEventListener('click', () => {
        modalSelesai.classList.remove('active');
        pendingSubmitMapel = null;
    });

    btnKonfirmasiSelesai.addEventListener('click', () => {
        modalSelesai.classList.remove('active');
        if (pendingSubmitMapel === 'indo') {
            submitIndo.style.display = 'none';
            hentikanTimer();
            tampilkanHasil('indo', indoHasilDiv, soalIndo, jawabanIndo);
        } else if (pendingSubmitMapel === 'mat') {
            submitMat.style.display = 'none';
            hentikanTimer();
            tampilkanHasil('mat', matHasilDiv, soalMat, jawabanMat);
        }
        pendingSubmitMapel = null;
    });

    submitIndo.addEventListener('click', () => {
        if (currentMapel !== 'indo') return;
        showModalSelesai('indo');
    });

    submitMat.addEventListener('click', () => {
        if (currentMapel !== 'mat') return;
        showModalSelesai('mat');
    });

    // Render awal soal (untuk persiapan)
    renderSoal(indoSoalContainer, 'indo', soalIndo, jawabanIndo);
    renderSoal(matSoalContainer, 'mat', soalMat, jawabanMat);
})();
</script>
</body>
</html>
